<!DOCTYPE html>
<html lang="es">

<head>

<meta charset="UTF-8">
<title>Sistema de Ventas</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>

body{
background:#f5f6fa;
}

.sidebar{
width:200px;
height:100vh;
background:#2f3640;
position:fixed;
padding:20px;
}

.sidebar button{
width:100%;
margin-bottom:10px;
}

.main{
margin-left:220px;
padding:20px;
}

.card{
margin-bottom:20px;
}

</style>

</head>

<body>


<div class="sidebar">

<button class="btn btn-light" onclick="mostrarInventario()">Inventario</button>

<button class="btn btn-light" onclick="mostrarVentas()">Ventas</button>

</div>


<div class="main">

<div class="row">

<div class="col-md-4">

<div class="card bg-success text-white">

<div class="card-body">

<h5>Ventas totales</h5>

<h2 id="totalVentas">$0</h2>

</div>

</div>

</div>

<div class="col-md-4">

<div class="card bg-primary text-white">

<div class="card-body">

<h5>Productos</h5>

<h2 id="totalProductos">0</h2>

</div>

</div>

</div>

</div>



<div id="inventario">

<div class="card">

<div class="card-body">

<h4>Inventario</h4>

<table class="table">

<thead>

<tr>

<th>Producto</th>
<th>Precio</th>
<th>Stock</th>
<th>Acción</th>

</tr>

</thead>

<tbody id="tablaProductos"></tbody>

</table>

</div>

</div>

</div>



<div id="ventas" style="display:none">

<div class="card">

<div class="card-body">

<h4>Historial de ventas</h4>

<table class="table">

<thead>

<tr>

<th>Producto</th>
<th>Precio</th>
<th>Fecha</th>

</tr>

</thead>

<tbody id="tablaVentas"></tbody>

</table>

</div>

</div>

</div>


</div>



<script>

const supabaseUrl = "https://lvtjeeokpejdexlsshqa.supabase.co"
const supabaseKey = "sb_publishable_ZPGnGr1Tv0hKf6D_yWH2Ug_r2ro954H"

const client = supabase.createClient(supabaseUrl,supabaseKey)



async function cargarProductos(){

const {data,error}=await client
.from("productos")
.select("*")
.order("nombre",{ascending:true})

if(error){
console.log(error)
return
}

document.getElementById("totalProductos").innerText=data.length

const tabla=document.getElementById("tablaProductos")

tabla.innerHTML=""

data.forEach(p=>{

tabla.innerHTML+=`

<tr>

<td>${p.nombre}</td>
<td>$${p.precio}</td>
<td>${p.stock}</td>

<td>

<button class="btn btn-success"

onclick="vender(${p.id},'${p.nombre}',${p.precio},${p.stock},${p.stock_minimo})">

Vender

</button>

</td>

</tr>

`

})

}



async function vender(id,nombre,precio,stock,stock_minimo){

if(stock<=0){

alert("No hay stock")

return

}

const nuevoStock=stock-1


await client
.from("productos")
.update({stock:nuevoStock})
.eq("id",id)



const {error}=await client
.from("ventas")
.insert([
{
nombre_producto:nombre,
precio:precio,
fecha:new Date().toISOString()
}
])

if(error){

console.log(error)

alert("Error registrando venta")

return

}


if(nuevoStock<=stock_minimo){

alert("⚠ Stock bajo de "+nombre)

}

await cargarProductos()

await verVentas()

await calcularDashboard()

}



async function verVentas(){

const {data,error}=await client
.from("ventas")
.select("*")
.order("fecha",{ascending:false})

if(error){
console.log(error)
return
}

const tabla=document.getElementById("tablaVentas")

tabla.innerHTML=""

data.forEach(v=>{

tabla.innerHTML+=`

<tr>

<td>${v.nombre_producto}</td>
<td>$${v.precio}</td>
<td>${new Date(v.fecha).toLocaleString()}</td>

</tr>

`

})

}



async function calcularDashboard(){

const {data,error}=await client
.from("ventas")
.select("precio")

if(error){
console.log(error)
return
}

let total=0

data.forEach(v=>{

total+=v.precio

})

document.getElementById("totalVentas").innerText="$"+total

}



function mostrarInventario(){

document.getElementById("inventario").style.display="block"

document.getElementById("ventas").style.display="none"

}



function mostrarVentas(){

document.getElementById("inventario").style.display="none"

document.getElementById("ventas").style.display="block"

}



cargarProductos()

verVentas()

calcularDashboard()

</script>


</body>
</html>

