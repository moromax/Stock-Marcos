<!DOCTYPE html>
<html lang="es">
<head>

<meta charset="UTF-8">
<title>Sistema de Ventas</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>

body{
background:#f4f6f9;
}

.sidebar{
height:100vh;
background:#1e293b;
color:white;
padding:20px;
}

.sidebar button{
width:100%;
margin-bottom:10px;
}

.card-dashboard{
padding:20px;
border-radius:10px;
color:white;
}

.card-productos{background:#3b82f6;}
.card-ventas{background:#10b981;}
.card-stock{background:#f59e0b;}

.total-card{
font-size:40px;
font-weight:bold;
text-align:center;
padding:30px;
}

.seccion{
display:none;
}

</style>

</head>

<body>

<div class="container-fluid">

<div class="row">

<div class="col-2 sidebar">

<h4>Sistema</h4>

<button class="btn btn-light" onclick="mostrarCaja()">Caja</button>
<button class="btn btn-light" onclick="mostrarInventario()">Inventario</button>
<button class="btn btn-light" onclick="mostrarStock()">Stock</button>
<button class="btn btn-light" onclick="mostrarVentas()">Ventas</button>

</div>

<div class="col-10 p-4">


<!-- CAJA -->

<div id="caja" class="seccion">

<h2>Caja</h2>

<input id="productoVenta" list="listaProductos" class="form-control mb-2" placeholder="Ingrese producto">

<datalist id="listaProductos"></datalist>

<input id="cantidadVenta" type="number" class="form-control mb-3" placeholder="Cantidad">

<div class="card card-body total-card">

TOTAL $<span id="totalVenta">0</span>

</div>

<button class="btn btn-success mt-3" onclick="realizarVenta()">Vender</button>

</div>



<!-- INVENTARIO -->

<div id="inventario" class="seccion">

<h2>Inventario</h2>

<ul id="listaInventario" class="list-group"></ul>

</div>



<!-- STOCK -->

<div id="stock" class="seccion">

<h2>Reposici√≥n de Stock</h2>

<ul id="listaStock" class="list-group"></ul>

</div>



<!-- VENTAS -->

<div id="ventas" class="seccion">

<h2>Ventas por fecha</h2>

<input type="date" id="fechaInicio">
<input type="date" id="fechaFin">

<button class="btn btn-primary" onclick="ventasPorFecha()">Buscar</button>

<ul id="listaVentas" class="list-group mt-3"></ul>

</div>



</div>
</div>
</div>



<script>

const supabaseUrl="https://lvtjeeokpejdexlsshqa.supabase.co"
const supabaseKey="sb_publishable_ZPGnGr1Tv0hKf6D_yWH2Ug_r2ro954H"

const client=supabase.createClient(supabaseUrl,supabaseKey)

let productos=[]



function mostrarCaja(){
ocultarTodo()
document.getElementById("caja").style.display="block"
}

function mostrarInventario(){
ocultarTodo()
document.getElementById("inventario").style.display="block"
}

function mostrarStock(){
ocultarTodo()
document.getElementById("stock").style.display="block"
}

function mostrarVentas(){
ocultarTodo()
document.getElementById("ventas").style.display="block"
verVentas()
}

function ocultarTodo(){
document.querySelectorAll(".seccion").forEach(s=>{
s.style.display="none"
})
}



async function cargarProductos(){

const {data}=await client
.from("productos")
.select("*")
.order("nombre",{ascending:true})

productos=data

const lista=document.getElementById("listaProductos")

lista.innerHTML=""

data.forEach(p=>{

const option=document.createElement("option")
option.value=p.nombre
lista.appendChild(option)

})

cargarInventario()
cargarStock()

}



document.getElementById("productoVenta").addEventListener("input",calcularTotal)
document.getElementById("cantidadVenta").addEventListener("input",calcularTotal)



function calcularTotal(){

const nombre=document.getElementById("productoVenta").value
const cantidad=parseInt(document.getElementById("cantidadVenta").value)

const producto=productos.find(p=>p.nombre==nombre)

if(!producto || !cantidad){

document.getElementById("totalVenta").textContent=0
return

}

const total=producto.precio*cantidad

document.getElementById("totalVenta").textContent=total

}



async function realizarVenta(){

const nombre=document.getElementById("productoVenta").value
const cantidad=parseInt(document.getElementById("cantidadVenta").value)

const producto=productos.find(p=>p.nombre==nombre)

if(!producto){
alert("Producto inexistente")
return
}

if(producto.stock<cantidad){
alert("Stock insuficiente")
return
}

const nuevoStock=producto.stock-cantidad

await client
.from("productos")
.update({stock:nuevoStock})
.eq("id",producto.id)


const total=producto.precio*cantidad

await client
.from("ventas")
.insert({
nombre_producto:nombre,
cantidad:cantidad,
precio_unitario:producto.precio,
precio_total:total
})

alert("Venta realizada")

document.getElementById("productoVenta").value=""
document.getElementById("cantidadVenta").value=""
document.getElementById("totalVenta").textContent=0

cargarProductos()

}



function cargarInventario(){

const lista=document.getElementById("listaInventario")

lista.innerHTML=""

productos.forEach(p=>{

const item=document.createElement("li")

item.className="list-group-item"

item.textContent=`${p.nombre} - $${p.precio} - Stock ${p.stock}`

lista.appendChild(item)

})

}



function cargarStock(){

const lista=document.getElementById("listaStock")

lista.innerHTML=""

productos.forEach(p=>{

const item=document.createElement("li")

item.className="list-group-item"

item.innerHTML=`
${p.nombre} - Stock ${p.stock}
<button onclick="reponer(${p.id},${p.stock})" class="btn btn-sm btn-warning float-end">Reponer</button>
`

lista.appendChild(item)

})

}



async function reponer(id,stock){

const cantidad=prompt("Cantidad a agregar")

if(!cantidad) return

const nuevoStock=stock+parseInt(cantidad)

await client
.from("productos")
.update({stock:nuevoStock})
.eq("id",id)

cargarProductos()

}



async function verVentas(){

const {data}=await client
.from("ventas")
.select("*")
.order("created_at",{ascending:false})

mostrarVentasLista(data)

}



async function ventasPorFecha(){

const inicio=document.getElementById("fechaInicio").value
const fin=document.getElementById("fechaFin").value

const {data}=await client
.from("ventas")
.select("*")
.gte("created_at",inicio)
.lte("created_at",fin+"T23:59:59")

mostrarVentasLista(data)

}



function mostrarVentasLista(data){

const lista=document.getElementById("listaVentas")

lista.innerHTML=""

data.forEach(v=>{

const item=document.createElement("li")

item.className="list-group-item"

const fecha=new Date(v.created_at).toLocaleString()

item.textContent=`${v.nombre_producto} x${v.cantidad} - $${v.precio_total} - ${fecha}`

lista.appendChild(item)

})

}



cargarProductos()

mostrarCaja()

</script>

</body>
</html>

