<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sistema de Stock</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
font-family: Arial;
max-width:700px;
margin:auto;
}

button{
margin-left:10px;
}
</style>

</head>

<body>

<h1>Sistema de Stock</h1>

<h2>Agregar producto</h2>

<input id="nombre" placeholder="Nombre producto">
<input id="precio" type="number" placeholder="Precio">
<input id="stock" type="number" placeholder="Stock">

<button onclick="agregarProducto()">Guardar</button>

<hr>

<h2>Productos</h2>

<ul id="listaProductos"></ul>

<hr>

<button onclick="verVentas()">Ver ventas</button>

<h2>Historial de ventas</h2>

<ul id="listaVentas"></ul>


<script>

const supabaseUrl = "https://lvtjeeokpejdexlsshqa.supabase.co"
const supabaseKey = "sb_publishable_ZPGnGr1Tv0hKf6D_yWH2Ug_r2ro954H"

const { createClient } = supabase
const client = createClient(supabaseUrl, supabaseKey)

console.log("Conectado a Supabase")



async function agregarProducto(){

const nombre = document.getElementById("nombre").value
const precio = document.getElementById("precio").value
const stock = document.getElementById("stock").value

await client
.from("productos")
.insert([
{
nombre:nombre,
precio:precio,
stock:stock
}
])

cargarProductos()

}



async function cargarProductos(){

const { data } = await client
.from("productos")
.select("*")

const lista = document.getElementById("listaProductos")
lista.innerHTML = ""

data.forEach(p => {

const item = document.createElement("li")

item.innerHTML =
`${p.nombre} - $${p.precio} - stock: ${p.stock}
<button onclick='venderProducto(${JSON.stringify(p)})'>Vender</button>`

lista.appendChild(item)

})

}



async function venderProducto(producto){

if(producto.stock <= 0){
alert("No hay stock")
return
}

await client
.from("productos")
.update({stock:producto.stock-1})
.eq("id",producto.id)



await client
.from("ventas")
.insert([
{
producto_id:producto.id,
nombre_producto:producto.nombre,
precio:producto.precio
}
])


cargarProductos()

}



async function verVentas(){

const { data } = await client
.from("ventas")
.select("*")
.order("fecha",{ascending:false})

const lista = document.getElementById("listaVentas")

lista.innerHTML=""

data.forEach(v=>{

const item=document.createElement("li")

const fecha=new Date(v.fecha).toLocaleString()

item.textContent=`${v.nombre_producto} - $${v.precio} - ${fecha}`

lista.appendChild(item)

})

}



cargarProductos()

</script>

</body>
</html>
