<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Sistema de Ventas</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>

body{
font-family: Arial;
margin:40px;
background:#f5f5f5;
}

h1{
margin-bottom:20px;
}

input,button{
padding:8px;
margin:5px;
}

button{
cursor:pointer;
}

ul{
background:white;
padding:20px;
border-radius:5px;
}

</style>

</head>
<body>

<h1>Sistema de Ventas</h1>

<h2>Agregar producto</h2>

<input id="nombre" placeholder="Nombre producto">
<input id="precio" type="number" placeholder="Precio">
<input id="stock" type="number" placeholder="Stock">
<input id="stock_minimo" type="number" placeholder="Stock mínimo">

<button onclick="agregarProducto()">Agregar</button>

<hr>

<h2>Productos</h2>

<ul id="listaProductos"></ul>

<hr>

<button onclick="verVentas()">Ver ventas</button>

<h2>Ventas</h2>

<ul id="listaVentas"></ul>

<script>

const supabaseUrl = "TU_URL_SUPABASE"
const supabaseKey = "TU_ANON_KEY"

const client = supabase.createClient(supabaseUrl,supabaseKey)



async function agregarProducto(){

const nombre = document.getElementById("nombre").value
const precio = document.getElementById("precio").value
const stock = document.getElementById("stock").value
const stock_minimo = document.getElementById("stock_minimo").value

await client
.from("productos")
.insert({
nombre:nombre,
precio:precio,
stock:stock,
stock_minimo:stock_minimo
})

cargarProductos()

}



async function cargarProductos(){

const { data } = await client
.from("productos")
.select("*")
.order("nombre",{ascending:true})

const lista = document.getElementById("listaProductos")

lista.innerHTML=""

data.forEach(p=>{

const item = document.createElement("li")

item.innerHTML = `
${p.nombre} - $${p.precio} - Stock: ${p.stock}
<button onclick="vender(${p.id},'${p.nombre}',${p.precio},${p.stock},${p.stock_minimo})">Vender</button>
`

lista.appendChild(item)

})

}



async function vender(id,nombre,precio,stock,stock_minimo){

if(stock <= 0){

alert("No hay stock")

return

}

const nuevoStock = stock - 1


await client
.from("productos")
.update({stock:nuevoStock})
.eq("id",id)



await client
.from("ventas")
.insert({
nombre_producto:nombre,
precio:precio
})



if(nuevoStock <= stock_minimo){

alert("⚠ STOCK BAJO de " + nombre)

}



cargarProductos()
verVentas()

}



async function verVentas(){

const { data } = await client
.from("ventas")
.select("*")
.order("fecha",{ascending:false})

const lista = document.getElementById("listaVentas")

lista.innerHTML=""

data.forEach(v=>{

const item = document.createElement("li")

const fecha = new Date(v.fecha).toLocaleString()

item.textContent = `${v.nombre_producto} - $${v.precio} - ${fecha}`

lista.appendChild(item)

})

}



cargarProductos()

</script>

</body>
</html>

