<!DOCTYPE html>
<html lang="es">

<head>

<meta charset="UTF-8">
<title>Panel de Ventas</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>

body{
font-family: Arial;
background:#111;
color:white;
margin:0;
display:flex;
}

#menu{
width:200px;
background:#1b1b1b;
padding:20px;
height:100vh;
}

#menu button{
width:100%;
margin-bottom:10px;
padding:10px;
background:#333;
border:none;
color:white;
cursor:pointer;
}

#menu button:hover{
background:#555;
}

#contenido{
flex:1;
padding:20px;
}

.card{
background:#1f1f1f;
padding:20px;
margin-bottom:20px;
border-radius:8px;
}

table{
width:100%;
border-collapse:collapse;
}

td,th{
padding:8px;
border-bottom:1px solid #444;
}

button.vender{
background:#2ecc71;
border:none;
padding:6px 10px;
cursor:pointer;
}

</style>

</head>

<body>

<div id="menu">

<button onclick="mostrarInventario()">Inventario</button>
<button onclick="mostrarVentas()">Ventas</button>

</div>

<div id="contenido">

<div class="card">
<h2>Dashboard</h2>
<div id="totalVentas">$0</div>
</div>

<div id="inventario">

<h2>Inventario</h2>

<table>
<thead>
<tr>
<th>Producto</th>
<th>Precio</th>
<th>Stock</th>
<th>Acción</th>
</tr>
</thead>

<tbody id="tablaProductos"></tbody>

</table>

</div>

<div id="ventas" style="display:none">

<h2>Historial de ventas</h2>

<table>

<thead>
<tr>
<th>Producto</th>
<th>Precio</th>
<th>Fecha</th>
</tr>
</thead>

<tbody id="tablaVentas"></tbody>

</table>

</div>

</div>

<script>

const supabaseUrl="TU_URL_SUPABASE"
const supabaseKey="TU_ANON_KEY"

const client=supabase.createClient(supabaseUrl,supabaseKey)

function mostrarInventario(){

document.getElementById("inventario").style.display="block"
document.getElementById("ventas").style.display="none"

}

function mostrarVentas(){

document.getElementById("inventario").style.display="none"
document.getElementById("ventas").style.display="block"

verVentas()

}

async function cargarProductos(){

const {data,error}=await client
.from("productos")
.select("*")
.order("id",{ascending:true})

if(error){

console.error(error)
return

}

let html=""

data.forEach(p=>{

html+=`

<tr>

<td>${p.nombre}</td>
<td>$${p.precio}</td>
<td>${p.stock}</td>

<td>
<button class="vender"
onclick="vender(${p.id},'${p.nombre}',${p.precio},${p.stock},${p.stock_minimo})">
Vender
</button>
</td>

</tr>

`

})

document.getElementById("tablaProductos").innerHTML=html

}

async function vender(id,nombre,precio,stock,stock_minimo){

if(stock<=0){

alert("No hay stock")
return

}

const nuevoStock=stock-1

const {error:errorStock}=await client
.from("productos")
.update({stock:nuevoStock})
.eq("id",id)

if(errorStock){

console.error(errorStock)
alert("Error actualizando stock")
return

}

const {error:errorVenta}=await client
.from("ventas")
.insert([
{
nombre_producto:nombre,
precio:precio,
fecha:new Date()
}
])

if(errorVenta){

console.error(errorVenta)
alert("Error registrando venta")
return

}

if(nuevoStock<=stock_minimo){

alert("⚠ STOCK BAJO de "+nombre)

}

cargarProductos()
verVentas()
calcularDashboard()

}

async function verVentas(){

const {data,error}=await client
.from("ventas")
.select("*")
.order("fecha",{ascending:false})

if(error){

console.error(error)
return

}

let html=""

data.forEach(v=>{

html+=`

<tr>

<td>${v.nombre_producto}</td>
<td>$${v.precio}</td>
<td>${new Date(v.fecha).toLocaleString()}</td>

</tr>

`

})

document.getElementById("tablaVentas").innerHTML=html

}

async function calcularDashboard(){

const {data,error}=await client
.from("ventas")
.select("precio")

if(error){

console.error(error)
return

}

let total=0

data.forEach(v=>{

total+=Number(v.precio)

})

document.getElementById("totalVentas").innerText="$"+total

}

cargarProductos()
verVentas()
calcularDashboard()

</script>

</body>
</html>

